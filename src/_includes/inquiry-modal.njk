{# Inquiry Modal #}
<div id="inquiry-modal" class="fixed inset-0 z-[100] opacity-0 pointer-events-none transition-opacity duration-200">
  <div class="absolute inset-0 bg-black/70" onclick="closeInquiryModal()"></div>
  
  <div class="absolute inset-0 flex items-center justify-center p-4">
    <div class="relative w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-neutral-900 rounded-2xl border border-white/10 shadow-2xl transform scale-95 transition-transform duration-200">
      <!-- Close button -->
      <button onclick="closeInquiryModal()" class="absolute top-4 right-4 z-10 inline-flex h-9 w-9 items-center justify-center rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition">
        <span class="sr-only">Затвори</span>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <!-- Modal content -->
      <div class="p-6 md:p-8">
        <h2 class="text-2xl md:text-3xl font-bold text-neutral-100 mb-2">Направете запитване</h2>
        <p class="text-sm text-neutral-400 mb-6">Попълнете формата и ще се свържа с вас при първа възможност.</p>

        {% if mailKey %}
          <form action="https://api.web3forms.com/submit" method="POST" class="space-y-4">
            <input type="hidden" name="access_key" value="{{ mailKey }}">
            <input type="hidden" name="subject" value="Ново запитване от сайта">
            <input type="hidden" name="redirect" value="{{ '/blagodarya/' | url }}">
            <input type="checkbox" name="botcheck" class="hidden" tabindex="-1" autocomplete="off">

            <div>
              <label for="modal-name" class="block text-xs text-neutral-400 mb-2">Пълно име</label>
              <input id="modal-name" name="name" type="text" class="w-full rounded-xl border border-white/10 bg-neutral-950/40 px-4 py-3 text-neutral-100 placeholder:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-brand-secondary/30" placeholder="Вашето пълно име" required>
            </div>

            <div>
              <label for="modal-phone" class="block text-xs text-neutral-400 mb-2">Телефон</label>
              <input id="modal-phone" name="phone" type="tel" class="w-full rounded-xl border border-white/10 bg-neutral-950/40 px-4 py-3 text-neutral-100 placeholder:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-brand-secondary/30" placeholder="Вашият телефон" required>
            </div>

            <div>
              <label for="modal-email" class="block text-xs text-neutral-400 mb-2">Имейл</label>
              <input id="modal-email" name="email" type="email" class="w-full rounded-xl border border-white/10 bg-neutral-950/40 px-4 py-3 text-neutral-100 placeholder:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-brand-secondary/30" placeholder="Вашият имейл" required>
            </div>

            <div>
              <label for="modal-message" class="block text-xs text-neutral-400 mb-2">Вашето запитване</label>
              <textarea id="modal-message" name="message" rows="5" class="w-full rounded-xl border border-white/10 bg-neutral-950/40 px-4 py-3 text-neutral-100 placeholder:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-brand-secondary/30 resize-none" placeholder="Опишете вашето запитване..." required></textarea>
            </div>

            <div class="pt-2">
              <button type="submit" class="btn-brand w-full">
                Изпрати запитване
              </button>
            </div>
          </form>
        {% else %}
          <div class="text-neutral-400 text-sm">
            Формата не е конфигурирана. Моля, свържете се с администратора.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  // Make functions globally accessible
  window.openInquiryModal = function() {
    const modal = document.getElementById('inquiry-modal');
    const content = modal.querySelector('.transform');
    if (modal) {
      modal.classList.remove('opacity-0', 'pointer-events-none');
      modal.classList.add('opacity-100');
      content.classList.remove('scale-95');
      content.classList.add('scale-100');
      document.body.style.overflow = 'hidden';
    }
  };

  window.closeInquiryModal = function() {
    const modal = document.getElementById('inquiry-modal');
    const content = modal.querySelector('.transform');
    if (modal) {
      modal.classList.add('opacity-0', 'pointer-events-none');
      modal.classList.remove('opacity-100');
      content.classList.add('scale-95');
      content.classList.remove('scale-100');
      document.body.style.overflow = '';
    }
  };


  // Close modal on ESC key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      window.closeInquiryModal();
    }
  });

  // Make all "запитване" buttons open the modal (for buttons that don't already have onclick)
  document.addEventListener('DOMContentLoaded', function() {
    // Find all links/buttons with "запитване" text
    const inquiryButtons = document.querySelectorAll('a, button');
    inquiryButtons.forEach(btn => {
      const text = btn.textContent.trim().toLowerCase();
      if ((text.includes('запитване') || text.includes('направи запитване')) && !btn.onclick && !btn.hasAttribute('onclick')) {
        btn.addEventListener('click', function(e) {
          // Only prevent default if it's not already a form button
          if (btn.tagName === 'A' && !btn.href.includes('#') && btn.href !== 'javascript:void(0)') {
            e.preventDefault();
            window.openInquiryModal();
          }
        });
      }
    });
  });
</script>

